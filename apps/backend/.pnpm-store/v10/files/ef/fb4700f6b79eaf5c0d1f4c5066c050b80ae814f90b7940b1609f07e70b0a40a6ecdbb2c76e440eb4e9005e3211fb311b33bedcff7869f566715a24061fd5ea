{"version":3,"file":"Tours.js","sources":["../../../../../../admin/src/components/UnstableGuidedTour/Tours.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport { Box, Popover } from '@strapi/design-system';\nimport { styled } from 'styled-components';\n\nimport { useAuth } from '../../features/Auth';\n\nimport { type State, type Action, unstableUseGuidedTour, ValidTourName } from './Context';\nimport { Step, createStepComponents } from './Step';\n\n/* -------------------------------------------------------------------------------------------------\n * Tours\n * -----------------------------------------------------------------------------------------------*/\n\nconst tours = {\n  contentManager: createTour('contentManager', [\n    {\n      name: 'Introduction',\n      content: (Step) => (\n        <Step.Root sideOffset={-36}>\n          <Step.Title\n            id=\"tours.contentManager.Introduction.title\"\n            defaultMessage=\"Content manager\"\n          />\n          <Step.Content\n            id=\"tours.contentManager.Introduction.content\"\n            defaultMessage=\"Create and manage content from your collection types and single types.\"\n          />\n          <Step.Actions showSkip />\n        </Step.Root>\n      ),\n    },\n  ]),\n} as const;\n\ntype Tours = typeof tours;\n\n/* -------------------------------------------------------------------------------------------------\n * GuidedTourTooltip\n * -----------------------------------------------------------------------------------------------*/\n\ntype Content = (\n  Step: Step,\n  {\n    state,\n    dispatch,\n  }: {\n    state: State;\n    dispatch: React.Dispatch<Action>;\n  }\n) => React.ReactNode;\n\nexport const GuidedTourOverlay = styled(Box)`\n  position: fixed;\n  inset: 0;\n  background-color: rgba(50, 50, 77, 0.2);\n  z-index: 10;\n  pointer-events: none;\n`;\n\nconst UnstableGuidedTourTooltip = ({\n  children,\n  content,\n  tourName,\n  step,\n}: {\n  children: React.ReactNode;\n  content: Content;\n  tourName: ValidTourName;\n  step: number;\n}) => {\n  const state = unstableUseGuidedTour('UnstableGuidedTourTooltip', (s) => s.state);\n  const dispatch = unstableUseGuidedTour('UnstableGuidedTourTooltip', (s) => s.dispatch);\n  const Step = React.useMemo(() => createStepComponents(tourName), [tourName]);\n\n  const isCurrentStep = state.tours[tourName].currentStep === step;\n  const isPopoverOpen = isCurrentStep && !state.tours[tourName].isCompleted;\n\n  // Lock the scroll\n  React.useEffect(() => {\n    if (!isPopoverOpen) return;\n\n    const originalStyle = window.getComputedStyle(document.body).overflow;\n    document.body.style.overflow = 'hidden';\n\n    return () => {\n      document.body.style.overflow = originalStyle;\n    };\n  }, [isPopoverOpen]);\n\n  return (\n    <>\n      {isPopoverOpen && <GuidedTourOverlay />}\n      <Popover.Root open={isPopoverOpen}>\n        <Popover.Anchor>{children}</Popover.Anchor>\n        {content(Step, { state, dispatch })}\n      </Popover.Root>\n    </>\n  );\n};\n\n/* -------------------------------------------------------------------------------------------------\n * Tour factory\n * -----------------------------------------------------------------------------------------------*/\n\ntype TourStep<P extends string> = {\n  name: P;\n  content: Content;\n};\n\nfunction createTour<const T extends ReadonlyArray<TourStep<string>>>(tourName: string, steps: T) {\n  type Components = {\n    [K in T[number]['name']]: React.ComponentType<{ children: React.ReactNode }>;\n  };\n\n  const tour = steps.reduce((acc, step, index) => {\n    if (step.name in acc) {\n      throw Error(`The tour: ${tourName} with step: ${step.name} has already been registered`);\n    }\n\n    acc[step.name as keyof Components] = ({ children }: { children: React.ReactNode }) => (\n      <UnstableGuidedTourTooltip\n        tourName={tourName as ValidTourName}\n        step={index}\n        content={step.content}\n      >\n        {children}\n      </UnstableGuidedTourTooltip>\n    );\n\n    return acc;\n  }, {} as Components);\n\n  return tour;\n}\n\nexport type { Content, Tours };\nexport { tours };\n"],"names":["tours","contentManager","createTour","name","content","Step","_jsxs","Root","sideOffset","_jsx","Title","id","defaultMessage","Content","Actions","showSkip","GuidedTourOverlay","styled","Box","UnstableGuidedTourTooltip","children","tourName","step","state","unstableUseGuidedTour","s","dispatch","React","useMemo","createStepComponents","isCurrentStep","currentStep","isPopoverOpen","isCompleted","useEffect","originalStyle","window","getComputedStyle","document","body","overflow","style","_Fragment","Popover","open","Anchor","steps","tour","reduce","acc","index","Error"],"mappings":"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"}